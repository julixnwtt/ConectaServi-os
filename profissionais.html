<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ConectaServi√ßos ‚Äî Profissionais</title>
  <link rel="icon" type="image/svg+xml" href="assets/img/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/estilos.css">
  <script src="assets/js/auth-guard.js"></script>
</head>
<body class="layout-has-fixed-footer">
  <header id="site-header"></header>
  <main class="py-4">
    <div class="container">
      <!-- Profissionais -->
      <h2 class="display-6 fw-bold mb-3 text-black">Profissionais Cadastrados</h2>
      <p class="text-black">
        Utilize os filtros para encontrar profissionais qualificados em sua regi√£o.
      </p>

      <form class="row g-2 card-3d p-3 mb-4">
        <div class="col-sm-6 col-lg-4">
          <label class="form-label">Categoria</label>
          <select class="form-select form-3d" id="fCategoria"></select>
        </div>
        
        <div class="col-sm-6 col-lg-4">
          <label class="form-label">Cidade</label>
          <input class="form-control form-3d" id="fCidade" placeholder="Ex: Indaiatuba" value="Indaiatuba"/>
        </div>
        
        <div class="col-sm-6 col-lg-4 d-flex align-items-end">
          <button type="button" id="btnFiltrar" class="btn btn-brand btn-3d w-100">Buscar</button>
        </div>
      </form>

      <div id="lista" class="row g-4">
        <div class="col-md-6 col-xl-4 prof-card professional-card" data-cat="Diarista" data-category="Diarista" data-cidade="Indaiatuba">
          <article class="card card-3d h-100">
            <div class="card-body d-flex gap-3">
              <div class="avatar-3d bg-ink text-white fw-bold">AL</div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between">
                  <h3 class="h6 mb-1">Ana Lima <span class="text-secondary fw-normal">‚Äî Diarista</span></h3>
                  <span class="badge bg-success-subtle text-success border">Verificado</span>
                </div>
                <div class="stars" data-stars="4.8"></div>
                <p class="small text-secondary mb-2">Indaiatuba, SP</p>
                <div class="d-flex flex-wrap gap-2">
                  <span class="badge tag-3d bg-body border text-secondary">Organiza√ß√£o</span>
                  <span class="badge tag-3d bg-body border text-secondary">Passadoria</span>
                </div>
                <div class="mt-3 d-flex gap-2">
                  <a class="btn btn-brand btn-3d" href="avaliacoes.html#ana-lima">Avalia√ß√µes</a>
                  <button class="btn btn-outline-brand btn-3d btn-avaliar" data-prestador-id="1" data-prestador-nome="Ana Lima">Avaliar</button>
                </div>
              </div>
            </div>
          </article>
        </div>

        <div class="col-md-6 col-xl-4 prof-card professional-card" data-cat="Jardineiro" data-category="Jardineiro" data-cidade="S√£o Paulo">
          <article class="card card-3d h-100">
            <div class="card-body d-flex gap-3">
              <div class="avatar-3d bg-ink text-white fw-bold">JP</div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between">
                  <h3 class="h6 mb-1">Jo√£o Pereira <span class="text-secondary fw-normal">‚Äî Jardineiro</span></h3>
                  <span class="badge bg-success-subtle text-success border">Verificado</span>
                </div>
                <div class="stars" data-stars="4.6"></div>
                <p class="small text-secondary mb-2">S√£o Paulo, SP</p>
                <div class="d-flex flex-wrap gap-2">
                  <span class="badge tag-3d bg-body border text-secondary">Paisagismo</span>
                  <span class="badge tag-3d bg-body border text-secondary">Podas</span>
                </div>
                <div class="mt-3 d-flex gap-2">
                  <a class="btn btn-brand btn-3d" href="avaliacoes.html#joao-pereira">Avalia√ß√µes</a>
                  <button class="btn btn-outline-brand btn-3d btn-avaliar" data-prestador-id="2" data-prestador-nome="Jo√£o Pereira">Avaliar</button>
                </div>
              </div>
            </div>
          </article>
        </div>

        <div class="col-md-6 col-xl-4 prof-card professional-card" data-cat="Bab√°" data-category="Bab√°" data-cidade="Curitiba">
          <article class="card card-3d h-100">
            <div class="card-body d-flex gap-3">
              <div class="avatar-3d bg-ink text-white fw-bold">MS</div>
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between">
                  <h3 class="h6 mb-1">Mariana Souza <span class="text-secondary fw-normal">‚Äî Bab√°</span></h3>
                  <span class="badge bg-success-subtle text-success border">Verificado</span>
                </div>
                <div class="stars" data-stars="4.9"></div>
                <p class="small text-secondary mb-2">Curitiba, PR</p>
                <div class="d-flex flex-wrap gap-2">
                  <span class="badge tag-3d bg-body border text-secondary">Primeiros socorros</span>
                  <span class="badge tag-3d bg-body border text-secondary">Noturno</span>
                </div>
                <div class="mt-3 d-flex gap-2">
                  <a class="btn btn-brand btn-3d" href="avaliacoes.html#mariana-souza">Avalia√ß√µes</a>
                  <button class="btn btn-outline-brand btn-3d btn-avaliar" data-prestador-id="3" data-prestador-nome="Mariana Souza">Avaliar</button>
                </div>
              </div>
            </div>
          </article>
        </div>
      </div>
    </div>
  </main><footer class="site-footer">
  <div class="footer-shell">
    <div class="footer-wave"></div>
    <div class="container footer-main">
      <div class="row align-items-start g-3">
        <div class="col-md-4">
          <div class="footer-brand">
            <span class="fw-bold">Conecta<span class="text-orange">Servi√ßos</span></span>
          </div>
          <p class="mb-1 text-steel-blue">Conectando clientes a profissionais qualificados</p>
          <div class="d-flex gap-3 small">
            <a href="landing-ajuda.html#central">Ajuda</a>
            <a href="landing-legal.html#termos">Legal</a>
          </div>
        </div>
        <div class="col-md-5">
          <div class="footer-links">
            <div class="col">
              <div class="fw-semibold">Explorar</div>
              <a href="como-funciona.html" class="d-block">Como funciona</a>
              <a href="profissionais.html" class="d-block">Profissionais</a>
              <a href="avaliacoes.html" class="d-block">Avalia√ß√µes</a>
            </div>
            <div class="col">
              <div class="fw-semibold">Cadastros</div>
              <a href="cadastro-cliente.html" class="d-block">Como Cliente</a>
              <a href="cadastro-prestador.html" class="d-block">Como Prestador</a>
            </div>
            <div class="col">
              <div class="fw-semibold">Legal</div>
              <a href="landing-legal.html#termos" class="d-block">Termos</a>
              <a href="landing-legal.html#privacidade" class="d-block">Privacidade</a>
              <a href="landing-legal.html#cookies" class="d-block">Cookies</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container d-flex justify-content-between small">
        <div>¬© <span id="y"></span> ConectaServi√ßos</div>
        <div class="d-none d-sm-block">Indaiatuba, SP</div>
      </div>
    </div>
  </div>
</footer>
<div class="cookie-banner">
  <div class="cookie-content">
    <div class="cookie-text">
      <h4>üç™ Ei, sobre cookies!</h4>
      <p>A gente usa cookies para melhorar sua experi√™ncia e lembrar suas prefer√™ncias. Ao aceitar, voc√™ concorda com nossa <a href="landing-legal.html#cookies">Pol√≠tica de Cookies</a>.</p>
    </div>
    <div class="cookie-buttons">
      <button id="btnAcceptCookies" class="btn btn-brand btn-3d">Aceitar</button>
      <button id="btnDeclineCookies" class="btn btn-outline-brand btn-3d">Recusar</button>
    </div>
  </div>
</div>

<!-- Modal de Avalia√ß√£o -->
<div class="modal fade" id="modalAvaliacao" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-rounded">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold">Avaliar Profissional</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <div class="text-center mb-4">
          <h6 id="prestadorNome" class="mb-3"></h6>
          <p class="text-secondary small">Sua avalia√ß√£o ajuda outros clientes a tomarem melhores decis√µes</p>
        </div>
        
        <form id="formAvaliacao">
          <input type="hidden" id="prestadorId" name="prestador">
          
          <!-- Sele√ß√£o de Estrelas -->
          <div class="mb-4 text-center">
            <label class="form-label d-block mb-3">Qual sua nota?</label>
            <div class="rating-input">
              <input type="radio" name="nota" value="5" id="star5" required>
              <label for="star5" title="5 estrelas">‚òÖ</label>
              <input type="radio" name="nota" value="4" id="star4">
              <label for="star4" title="4 estrelas">‚òÖ</label>
              <input type="radio" name="nota" value="3" id="star3">
              <label for="star3" title="3 estrelas">‚òÖ</label>
              <input type="radio" name="nota" value="2" id="star2">
              <label for="star2" title="2 estrelas">‚òÖ</label>
              <input type="radio" name="nota" value="1" id="star1">
              <label for="star1" title="1 estrela">‚òÖ</label>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Servi√ßo realizado</label>
            <input type="text" class="form-control form-3d" name="servico" placeholder="Ex: Limpeza residencial" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Seu coment√°rio</label>
            <textarea class="form-control form-3d" name="comentario" rows="4" placeholder="Conte como foi sua experi√™ncia..." required></textarea>
          </div>

          <div class="alert alert-danger d-none" id="avaliacaoError"></div>
          <div class="alert alert-success d-none" id="avaliacaoSuccess"></div>

          <button type="submit" class="btn btn-brand btn-3d w-100">
            Enviar Avalia√ß√£o
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
.rating-input {
  direction: rtl;
  display: inline-flex;
  gap: 0.25rem;
}

.rating-input input {
  display: none;
}

.rating-input label {
  cursor: pointer;
  font-size: 2.5rem;
  color: #ddd;
  transition: color 0.2s;
}

.rating-input label:hover,
.rating-input label:hover ~ label,
.rating-input input:checked ~ label {
  color: #FFD700;
}
</style>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script><script src="assets/js/scripts.js"></script>
<script>

  // Fun√ß√£o para abrir modal de avalia√ß√£o
  document.querySelectorAll('.btn-avaliar').forEach(btn => {
    btn.addEventListener('click', function() {
      const prestadorId = this.getAttribute('data-prestador-id');
      const prestadorNome = this.getAttribute('data-prestador-nome');
      
      // Verifica se est√° logado
      const user = localStorage.getItem('user');
      if (!user) {
        alert('Voc√™ precisa estar logado para avaliar um profissional');
        window.location.href = 'cadastro.html';
        return;
      }

      const userData = JSON.parse(user);
      if (userData.tipo !== 'cliente') {
        alert('Apenas clientes podem avaliar profissionais');
        return;
      }

      // Preenche o modal
      document.getElementById('prestadorId').value = prestadorId;
      document.getElementById('prestadorNome').textContent = prestadorNome;
      
      // Limpa formul√°rio
      document.getElementById('formAvaliacao').reset();
      document.getElementById('avaliacaoError').classList.add('d-none');
      document.getElementById('avaliacaoSuccess').classList.add('d-none');
      
      // Abre o modal
      const modal = new bootstrap.Modal(document.getElementById('modalAvaliacao'));
      modal.show();
    });
  });

  // Processa envio da avalia√ß√£o
  document.getElementById('formAvaliacao').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const errorDiv = document.getElementById('avaliacaoError');
    const successDiv = document.getElementById('avaliacaoSuccess');
    
    const dados = {
      prestador: formData.get('prestador'),
      nota: parseInt(formData.get('nota')),
      servico: formData.get('servico'),
      comentario: formData.get('comentario')
    };

    try {
      const response = await fetch('http://localhost:3000/avaliacoes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dados)
      });

      const data = await response.json();

      if (data.success) {
        successDiv.textContent = 'Avalia√ß√£o enviada com sucesso!';
        successDiv.classList.remove('d-none');
        errorDiv.classList.add('d-none');
        
        // Fecha modal ap√≥s 2 segundos
        setTimeout(() => {
          bootstrap.Modal.getInstance(document.getElementById('modalAvaliacao')).hide();
          location.reload(); // Recarrega para mostrar nova avalia√ß√£o
        }, 2000);
      } else {
        errorDiv.textContent = data.error?.message || 'Erro ao enviar avalia√ß√£o';
        errorDiv.classList.remove('d-none');
        successDiv.classList.add('d-none');
      }
    } catch (error) {
      errorDiv.textContent = 'Erro de conex√£o. Verifique se o servidor est√° rodando.';
      errorDiv.classList.remove('d-none');
      successDiv.classList.add('d-none');
    }
  });
</script>
</body></html>